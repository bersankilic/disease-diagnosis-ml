<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI HastalÄ±k TeÅŸhis Sistemi</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --accent-color: #e74c3c;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --light-bg: #ecf0f1;
      }

      body {
        background: linear-gradient(135deg, var(--light-bg) 0%, #bdc3c7 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
      }

      .navbar {
        background: var(--primary-color) !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .navbar-brand {
        font-weight: bold;
        color: white !important;
      }

      .hero-section {
        background: linear-gradient(
          135deg,
          var(--secondary-color),
          var(--primary-color)
        );
        color: white;
        padding: 4rem 0;
        margin-bottom: 3rem;
      }

      .hero-title {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 1rem;
      }

      .hero-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card-header {
        background: var(--primary-color);
        color: white;
        border-radius: 15px 15px 0 0 !important;
        font-weight: bold;
      }

      .symptom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 10px;
        max-height: 400px;
        overflow-y: auto;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #f8f9fa;
      }

      .symptom-item {
        display: flex;
        align-items: center;
        padding: 8px;
        background: white;
        border-radius: 8px;
        transition: background-color 0.2s;
      }

      .symptom-item:hover {
        background-color: #e9ecef;
      }

      .symptom-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
      }

      .symptom-item label {
        margin: 0;
        cursor: pointer;
        font-size: 0.9rem;
      }

      .btn-primary {
        background: var(--secondary-color);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background: var(--primary-color);
        transform: translateY(-2px);
      }

      .btn-clear {
        background: var(--warning-color);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: bold;
        color: white;
        transition: all 0.3s ease;
      }

      .btn-clear:hover {
        background: #d35400;
        transform: translateY(-2px);
      }

      .result-card {
        background: white;
        border-left: 5px solid var(--success-color);
      }

      .probability-bar {
        height: 20px;
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 10px;
      }

      .probability-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--success-color),
          var(--secondary-color)
        );
        transition: width 0.5s ease;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner-border {
        color: var(--secondary-color);
      }

      .feature-icon {
        color: var(--secondary-color);
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .stats-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
      }

      .stats-number {
        font-size: 2rem;
        font-weight: bold;
        color: var(--secondary-color);
      }

      .search-box {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        transition: border-color 0.3s ease;
      }

      .search-box:focus {
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }

      .footer {
        background: var(--primary-color);
        color: white;
        padding: 2rem 0;
        margin-top: 4rem;
      }

      .report-header {
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 15px;
      }

      .severity-badge {
        font-size: 0.8rem;
        padding: 5px 10px;
      }

      .progress {
        height: 8px;
      }
      .list-group-item {
        border: none;
        padding: 5px 0;
      }

      /* YÃ¶ntem SeÃ§imi Stilleri */
      .method-card {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        height: 100%;
      }

      .method-card:hover {
        border-color: var(--secondary-color);
        background-color: #f8f9fa;
        transform: translateY(-2px);
      }

      .method-card.active {
        border-color: var(--secondary-color);
        background-color: var(--secondary-color);
        color: white;
      }

      .method-card.active .method-icon {
        color: white;
      }

      .method-icon {
        font-size: 2.5rem;
        color: var(--secondary-color);
        margin-bottom: 15px;
      }

      /* Chatbot Stilleri */
      .chatbot-container {
        border: 1px solid #dee2e6;
        border-radius: 15px;
        overflow: hidden;
        background: white;
      }

      .chat-header {
        background: var(--primary-color);
        color: white;
        padding: 15px 20px;
        font-weight: bold;
      }

      .chat-messages {
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        background: #f8f9fa;
      }

      .message {
        margin-bottom: 20px;
        display: flex;
        align-items: flex-start;
      }

      .bot-message {
        margin-bottom: 20px;
        display: flex;
        align-items: flex-start;
      }

      .user-message {
        margin-bottom: 20px;
        display: flex;
        align-items: flex-start;
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      .bot-message .message-avatar {
        background: var(--secondary-color);
        color: white;
        margin-right: 15px;
      }

      .user-message .message-avatar {
        background: var(--success-color);
        color: white;
        margin-left: 15px;
      }

      .message-content {
        flex: 1;
        background: white;
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .user-message .message-content {
        background: var(--success-color);
        color: white;
      }

      .message-content p {
        margin: 0;
        line-height: 1.4;
      }

      .message-content p:not(:last-child) {
        margin-bottom: 10px;
      }

      .chat-input-area {
        padding: 20px;
        background: white;
        border-top: 1px solid #dee2e6;
      }

      .typing-indicator {
        color: var(--secondary-color);
        font-style: italic;
        margin-top: 10px;
        padding: 5px 0;
      }

      .symptom-tag {
        display: inline-block;
        background: var(--secondary-color);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.85rem;
        margin: 2px;
      }

      @media (max-width: 768px) {
        .hero-title {
          font-size: 2rem;
        }

        .symptom-grid {
          grid-template-columns: 1fr;
        }

        .method-card {
          margin-bottom: 15px;
        }

        .chat-messages {
          height: 300px;
        }
      }

      @media print {
        .btn,
        .navbar,
        .footer {
          display: none !important;
        }

        .card {
          page-break-inside: avoid;
          box-shadow: none;
          border: 1px solid #dee2e6;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-stethoscope me-2"></i>
          AI HastalÄ±k TeÅŸhis Sistemi
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Ana Sayfa</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/about">HakkÄ±nda</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container text-center">
        <h1 class="hero-title">
          <i class="fas fa-brain me-3"></i>
          AI Destekli HastalÄ±k TeÅŸhisi
        </h1>
        <p class="hero-subtitle">
          GeliÅŸmiÅŸ makine Ã¶ÄŸrenmesi algoritmalarÄ± ile semptomlarÄ±nÄ±zdan hastalÄ±k
          teÅŸhisi yapÄ±n
        </p>
      </div>
    </section>

    <!-- Main Content -->
    <div class="container">
      <!-- Statistics -->
      <div class="row mb-5">
        <div class="col-md-4 mb-3">
          <div class="stats-card">
            <i class="fas fa-robot feature-icon"></i>
            <div class="stats-number">{{ models|length }}</div>
            <div class="text-muted">Yapay Zeka Modeli</div>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="stats-card">
            <i class="fas fa-list-ul feature-icon"></i>
            <div class="stats-number">{{ symptoms|length }}</div>
            <div class="text-muted">Semptom Kategorisi</div>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="stats-card">
            <i class="fas fa-hospital feature-icon"></i>
            <div class="stats-number">40+</div>
            <div class="text-muted">HastalÄ±k Kategorisi</div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Semptom SeÃ§imi -->
        <div class="col-lg-8 mb-4">
          <div class="card">
            <div class="card-header">
              <i class="fas fa-clipboard-list me-2"></i>
              Semptom GiriÅŸi
            </div>
            <div class="card-body">
              <!-- YÃ¶ntem SeÃ§imi -->
              <div class="mb-4">
                <label class="form-label fw-bold"
                  >Semptom GiriÅŸi YÃ¶ntemi:</label
                >
                <div class="row g-3">
                  <div class="col-md-6">
                    <div
                      class="method-card"
                      onclick="selectMethod('checkbox')"
                      id="checkboxMethod"
                    >
                      <div class="method-icon">
                        <i class="fas fa-list-check"></i>
                      </div>
                      <h5>Listeden SeÃ§</h5>
                      <p class="text-muted mb-0">
                        SemptomlarÄ± listeden seÃ§erek teÅŸhis yaptÄ±rÄ±n
                      </p>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div
                      class="method-card"
                      onclick="selectMethod('chatbot')"
                      id="chatbotMethod"
                    >
                      <div class="method-icon">
                        <i class="fas fa-comments"></i>
                      </div>
                      <h5>
                        Sohbet ile Anlat
                        <span class="badge bg-warning text-dark ms-2"
                          >BETA</span
                        >
                      </h5>
                      <p class="text-muted mb-0">
                        Chatbot ile sohbet ederek semptomlarÄ±nÄ±zÄ± anlatÄ±n
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <form id="symptomForm">
                <div class="mb-3">
                  <label class="form-label">Model SeÃ§imi:</label>
                  <select class="form-select" id="modelSelect">
                    {% for model in models %}
                    <option value="{{ model }}">{{ model }}</option>
                    {% endfor %}
                  </select>
                </div>
                <!-- Checkbox YÃ¶ntemi -->
                <div id="checkboxSection">
                  <div class="mb-3">
                    <label class="form-label"
                      >YaÅŸadÄ±ÄŸÄ±nÄ±z SemptomlarÄ± SeÃ§in:</label
                    >

                    <div class="d-flex justify-content-between mb-2">
                      <span class="text-muted">
                        SeÃ§ilen: <span id="selectedCount">0</span> semptom
                      </span>
                      <button
                        type="button"
                        class="btn btn-sm btn-clear"
                        onclick="clearSymptoms()"
                      >
                        <i class="fas fa-trash me-1"></i>Temizle
                      </button>
                    </div>

                    <!-- Arama Kutusu -->
                    <div class="mb-3">
                      <div class="input-group">
                        <span class="input-group-text">
                          <i class="fas fa-search"></i>
                        </span>
                        <input
                          type="text"
                          class="form-control search-box"
                          id="symptomSearch"
                          placeholder="Semptom arayÄ±n... (Ã¶rn: baÅŸ aÄŸrÄ±sÄ±, ateÅŸ, Ã¶ksÃ¼rÃ¼k)"
                          onkeyup="filterSymptoms()"
                        />
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          onclick="clearSearch()"
                          title="AramayÄ± temizle"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                      <small class="text-muted d-block mt-1">
                        <span id="filteredCount">{{ symptoms|length }}</span>
                        semptom gÃ¶steriliyor
                      </small>
                    </div>

                    <div class="symptom-grid" id="symptomGrid">
                      <!-- Semptomlar JavaScript ile yÃ¼klenecek -->
                    </div>
                  </div>
                </div>

                <!-- Chatbot YÃ¶ntemi -->
                <div id="chatbotSection" style="display: none">
                  <div class="chatbot-container">
                    <div class="chat-header">
                      <i class="fas fa-robot me-2"></i>
                      <strong>Sanal Doktor AsistanÄ±</strong>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-secondary float-end"
                        onclick="clearChat()"
                      >
                        <i class="fas fa-refresh me-1"></i>Sohbeti SÄ±fÄ±rla
                      </button>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                      <div class="bot-message">
                        <div class="message-avatar">
                          <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                          <p>Merhaba! Ben Sanal Doktor AsistanÄ±nÄ±zÄ±m. ğŸ‘‹</p>
                          <p>
                            Hangi semptomlarÄ±nÄ±zÄ± yaÅŸÄ±yorsunuz? LÃ¼tfen
                            detaylarÄ±yla anlatÄ±n.
                          </p>
                          <p>
                            <small class="text-muted"
                              >Ã–rnek: "BaÅŸÄ±m aÄŸrÄ±yor, ateÅŸim var ve
                              Ã¶ksÃ¼rÃ¼yorum"</small
                            >
                          </p>
                        </div>
                      </div>
                    </div>

                    <div class="chat-input-area">
                      <div class="input-group">
                        <input
                          type="text"
                          class="form-control"
                          id="chatInput"
                          placeholder="SemptomlarÄ±nÄ±zÄ± yazÄ±n..."
                          onkeypress="handleChatKeyPress(event)"
                        />
                        <button
                          type="button"
                          class="btn btn-primary"
                          onclick="sendChatMessage()"
                          id="sendButton"
                        >
                          <i class="fas fa-paper-plane"></i>
                        </button>
                      </div>
                      <div
                        class="typing-indicator"
                        id="typingIndicator"
                        style="display: none"
                      >
                        <i class="fas fa-robot me-2"></i>AI yazÄ±yor...
                      </div>
                    </div>
                  </div>
                </div>

                <div class="text-center">
                  <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-diagnoses me-2"></i>
                    TeÅŸhis Et
                  </button>
                </div>
              </form>

              <div class="loading" id="loading">
                <div class="spinner-border" role="status">
                  <span class="visually-hidden">YÃ¼kleniyor...</span>
                </div>
                <p class="mt-2">AI modeli analiz ediyor...</p>
              </div>
            </div>
          </div>
        </div>
        <!-- SonuÃ§lar -->
        <div class="col-lg-4 mb-4">
          <div class="card result-card" id="resultCard" style="display: none">
            <div class="card-header">
              <i class="fas fa-chart-line me-2"></i>
              TeÅŸhis Sonucu
            </div>
            <div class="card-body">
              <div id="predictionResult"></div>

              <!-- Rapor Butonu -->
              <div
                class="text-center mt-3"
                id="reportSection"
                style="display: none"
              >
                <button
                  class="btn btn-info btn-sm"
                  onclick="generateDetailedReport()"
                >
                  <i class="fas fa-file-medical me-2"></i>
                  DetaylÄ± Rapor OluÅŸtur
                </button>
              </div>
            </div>
          </div>

          <!-- DetaylÄ± Rapor KartÄ± -->
          <div class="card mt-4" id="detailedReportCard" style="display: none">
            <div class="card-header">
              <i class="fas fa-file-medical me-2"></i>
              DetaylÄ± TeÅŸhis Raporu
              <button
                class="btn btn-sm btn-outline-light float-end"
                onclick="printReport()"
              >
                <i class="fas fa-print"></i>
              </button>
            </div>
            <div class="card-body" id="detailedReportContent">
              <!-- DetaylÄ± rapor iÃ§eriÄŸi buraya gelecek -->
            </div>
          </div>

          <!-- YardÄ±m KartÄ± -->
          <div class="card mt-4">
            <div class="card-header">
              <i class="fas fa-info-circle me-2"></i>
              NasÄ±l KullanÄ±lÄ±r?
            </div>
            <div class="card-body">
              <ol class="mb-0">
                <li class="mb-2">KullanÄ±lacak AI modelini seÃ§in</li>
                <li class="mb-2">Arama kutusunu kullanarak semptom bulun</li>
                <li class="mb-2">YaÅŸadÄ±ÄŸÄ±nÄ±z semptomlarÄ± iÅŸaretleyin</li>
                <li class="mb-2">"TeÅŸhis Et" butonuna tÄ±klayÄ±n</li>
                <li>SonuÃ§larÄ± inceleyin</li>
              </ol>
              <div class="alert alert-warning mt-3 mb-0">
                <small>
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  Bu sistem sadece bilgilendirme amaÃ§lÄ±dÄ±r. Kesin teÅŸhis iÃ§in
                  mutlaka doktora baÅŸvurun.
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container text-center">
        <p class="mb-0">AI HastalÄ±k TeÅŸhis Sistemi - 2025</p>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
      // Semptom verilerini JavaScript'e aktar
      const allSymptoms = [
        {% for symptom in symptoms %}
        {
          english: "{{ symptom.english }}",
          turkish: "{{ symptom.turkish }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
      ];      // Sayfa yÃ¼klendiÄŸinde semptomlarÄ± gÃ¶ster - Bu fonksiyon artÄ±k gerekli deÄŸil, main DOMContentLoaded iÃ§inde Ã§aÄŸrÄ±lÄ±yor

      function renderSymptoms(symptoms) {
        const grid = document.getElementById('symptomGrid');
        grid.innerHTML = '';

        symptoms.forEach((symptom, index) => {
          const div = document.createElement('div');
          div.className = 'symptom-item';
          div.innerHTML = `
            <input
              type="checkbox"
              id="symptom_${index}"
              name="symptoms"
              value="${symptom.english}"
              onchange="updateSelectedCount()"
            />
            <label for="symptom_${index}">
              ${symptom.turkish}
            </label>
          `;
          grid.appendChild(div);
        });
      }

      function filterSymptoms() {
        const searchText = document.getElementById('symptomSearch').value.toLowerCase();

        if (searchText === '') {
          renderSymptoms(allSymptoms);
          updateFilteredCount(allSymptoms.length);
          return;
        }

        const filteredSymptoms = allSymptoms.filter(symptom =>
          symptom.turkish.toLowerCase().includes(searchText) ||
          symptom.english.toLowerCase().includes(searchText)
        );

        renderSymptoms(filteredSymptoms);
        updateFilteredCount(filteredSymptoms.length);
      }

      function clearSearch() {
        document.getElementById('symptomSearch').value = '';
        renderSymptoms(allSymptoms);
        updateFilteredCount(allSymptoms.length);
      }

      function updateFilteredCount(count) {
        document.getElementById('filteredCount').textContent = count;
      }

      function updateSelectedCount() {
        const checkedBoxes = document.querySelectorAll('input[name="symptoms"]:checked');
        document.getElementById("selectedCount").textContent = checkedBoxes.length;
      }

      function clearSymptoms() {
        const checkboxes = document.querySelectorAll('input[name="symptoms"]');
        checkboxes.forEach((cb) => (cb.checked = false));
        updateSelectedCount();
      }

      function showLoading() {
        document.getElementById("loading").style.display = "block";
        document.getElementById("resultCard").style.display = "none";
      }

      function hideLoading() {
        document.getElementById("loading").style.display = "none";
      }      function displayResult(result) {
        const resultDiv = document.getElementById("predictionResult");

        if (result.error) {
          resultDiv.innerHTML = `
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>
              ${result.error}
            </div>
          `;
          document.getElementById("reportSection").style.display = "none";
        } else {
          let probabilitiesHtml = "";
          if (result.probabilities && result.probabilities.length > 0) {
            probabilitiesHtml = `
              <h6 class="mt-3">OlasÄ±lÄ±k DaÄŸÄ±lÄ±mÄ±:</h6>
              ${result.probabilities
                .map(
                  ([disease, prob]) => `
                  <div class="mb-2">
                    <div class="d-flex justify-content-between">
                      <small>${disease}</small>
                      <small>${(prob * 100).toFixed(1)}%</small>
                    </div>
                    <div class="probability-bar">
                      <div class="probability-fill" style="width: ${
                        prob * 100
                      }%"></div>
                    </div>
                  </div>
                `
                )
                .join("")}
            `;
          }

          resultDiv.innerHTML = `
            <div class="alert alert-success">
              <h5 class="alert-heading">
                <i class="fas fa-check-circle me-2"></i>
                Tahmin Edilen HastalÄ±k
              </h5>
              <h4 class="text-success">${result.prediction}</h4>
              <hr>
              <small class="text-muted">
                Model: ${result.model_used}
              </small>
            </div>
            ${probabilitiesHtml}
            <div class="alert alert-info mt-3">
              <i class="fas fa-info-circle me-2"></i>
              <small>Bu sonuÃ§ AI tahminidir. Kesin teÅŸhis iÃ§in doktora baÅŸvurunuz.</small>
            </div>
          `;

          // Rapor butonunu gÃ¶ster ve geÃ§ici olarak sonucu sakla
          document.getElementById("reportSection").style.display = "block";
          window.currentPrediction = result;
        }

        document.getElementById("resultCard").style.display = "block";
      }

      // DetaylÄ± rapor oluÅŸturma fonksiyonu
      async function generateDetailedReport() {
        if (!window.currentPrediction) {
          alert('Ã–nce bir teÅŸhis yapmalÄ±sÄ±nÄ±z!');
          return;
        }

        const selectedSymptoms = Array.from(
          document.querySelectorAll('input[name="symptoms"]:checked')
        ).map((cb) => cb.value);

        try {
          const response = await fetch('/generate-report', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              prediction_data: window.currentPrediction,
              symptoms: selectedSymptoms
            }),
          });

          const reportData = await response.json();

          if (reportData.success) {
            displayDetailedReport(reportData.report);
          } else {
            alert('Rapor oluÅŸturulurken hata: ' + reportData.error);
          }
        } catch (error) {
          alert('Rapor oluÅŸturma hatasÄ±: ' + error.message);
        }
      }

      // DetaylÄ± raporu gÃ¶sterme fonksiyonu
      function displayDetailedReport(report) {
        const reportDiv = document.getElementById("detailedReportContent");
        const diseaseInfo = window.currentPrediction.disease_info || {};

        const severityColor = getSeverityColor(diseaseInfo.severity || 'Bilinmiyor');

        reportDiv.innerHTML = `
          <div class="report-header text-center mb-4">
            <h5><i class="fas fa-file-medical me-2"></i>Medikal TeÅŸhis Raporu</h5>
            <p class="text-muted">Rapor No: ${report.report_id}</p>
            <p class="text-muted">Tarih: ${report.timestamp}</p>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="card border-primary mb-3">
                <div class="card-header bg-primary text-white">
                  <i class="fas fa-diagnoses me-2"></i>TeÅŸhis Bilgileri
                </div>
                <div class="card-body">
                  <p><strong>Tahmin Edilen HastalÄ±k:</strong></p>
                  <h5 class="text-primary">${report.diagnosis}</h5>
                  <p><strong>KullanÄ±lan Model:</strong> ${report.model_used}</p>
                  <p><strong>Ciddiyet Seviyesi:</strong>
                    <span class="badge" style="background-color: ${severityColor}">
                      ${diseaseInfo.severity || 'Bilinmiyor'}
                    </span>
                  </p>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card border-info mb-3">
                <div class="card-header bg-info text-white">
                  <i class="fas fa-list-ul me-2"></i>Belirtilen Semptomlar
                </div>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    ${report.patient_symptoms.map(symptom =>
                      `<li class="list-group-item"><i class="fas fa-check text-success me-2"></i>${symptom}</li>`
                    ).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>

          ${diseaseInfo.description ? `
          <div class="card border-success mb-3">
            <div class="card-header bg-success text-white">
              <i class="fas fa-info-circle me-2"></i>HastalÄ±k AÃ§Ä±klamasÄ±
            </div>
            <div class="card-body">
              <p>${diseaseInfo.description}</p>
            </div>
          </div>
          ` : ''}

          ${report.probabilities.length > 0 ? `
          <div class="card border-warning mb-3">
            <div class="card-header bg-warning text-white">
              <i class="fas fa-chart-bar me-2"></i>OlasÄ±lÄ±k Analizi
            </div>
            <div class="card-body">
              ${report.probabilities.map(([disease, prob]) => `
                <div class="mb-2">
                  <div class="d-flex justify-content-between">
                    <span>${disease}</span>
                    <span>${(prob * 100).toFixed(1)}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: ${prob * 100}%"></div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}

          <div class="row">
            ${diseaseInfo.symptoms ? `
            <div class="col-md-6">
              <div class="card border-secondary mb-3">
                <div class="card-header">
                  <i class="fas fa-thermometer me-2"></i>Tipik Semptomlar
                </div>
                <div class="card-body">
                  <ul>
                    ${diseaseInfo.symptoms.map(symptom => `<li>${symptom}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>
            ` : ''}

            ${diseaseInfo.causes ? `
            <div class="col-md-6">
              <div class="card border-secondary mb-3">
                <div class="card-header">
                  <i class="fas fa-search me-2"></i>OlasÄ± Nedenler
                </div>
                <div class="card-body">
                  <ul>
                    ${diseaseInfo.causes.map(cause => `<li>${cause}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>
            ` : ''}
          </div>

          <div class="row">
            ${diseaseInfo.treatment ? `
            <div class="col-md-6">
              <div class="card border-success mb-3">
                <div class="card-header bg-light">
                  <i class="fas fa-pills me-2"></i>Ã–nerilen Tedavi
                </div>
                <div class="card-body">
                  <ul>
                    ${diseaseInfo.treatment.map(treatment => `<li>${treatment}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>
            ` : ''}

            ${diseaseInfo.prevention ? `
            <div class="col-md-6">
              <div class="card border-primary mb-3">
                <div class="card-header bg-light">
                  <i class="fas fa-shield-alt me-2"></i>Ã–nleyici Tedbirler
                </div>
                <div class="card-body">
                  <ul>
                    ${diseaseInfo.prevention.map(prevention => `<li>${prevention}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>
            ` : ''}
          </div>

          ${diseaseInfo.when_to_see_doctor ? `
          <div class="alert alert-danger">
            <h6><i class="fas fa-exclamation-triangle me-2"></i>Doktora BaÅŸvuru ZamanÄ±</h6>
            <ul class="mb-0">
              ${diseaseInfo.when_to_see_doctor.map(condition => `<li>${condition}</li>`).join('')}
            </ul>
          </div>
          ` : ''}

          <div class="alert alert-warning">
            <h6><i class="fas fa-exclamation-circle me-2"></i>Ã–nemli UyarÄ±</h6>
            <p class="mb-0">Bu rapor yapay zeka tahminine dayanmaktadÄ±r ve kesin teÅŸhis deÄŸildir.
            SaÄŸlÄ±k durumunuz hakkÄ±nda kesin bilgi iÃ§in mutlaka bir saÄŸlÄ±k profesyoneline danÄ±ÅŸÄ±nÄ±z.</p>
          </div>

          <div class="text-center mt-4">
            <small class="text-muted">
              Bu rapor AI HastalÄ±k TeÅŸhis Sistemi tarafÄ±ndan ${report.timestamp} tarihinde oluÅŸturulmuÅŸtur.
            </small>
          </div>
        `;

        document.getElementById("detailedReportCard").style.display = "block";

        // Rapor kartÄ±na kaydÄ±r
        document.getElementById("detailedReportCard").scrollIntoView({
          behavior: 'smooth'
        });
      }

      // Ciddiyet seviyesine gÃ¶re renk belirleme
      function getSeverityColor(severity) {
        switch(severity.toLowerCase()) {
          case 'hafif': return '#28a745';
          case 'hafif-orta': return '#ffc107';
          case 'orta': return '#fd7e14';
          case 'orta-ciddi': return '#dc3545';
          case 'ciddi': return '#dc3545';
          case 'Ã§ok ciddi - acil': return '#721c24';
          default: return '#6c757d';
        }
      }

      // Raporu yazdÄ±rma fonksiyonu
      function printReport() {
        const reportContent = document.getElementById("detailedReportContent").innerHTML;
        const printWindow = window.open('', '_blank');

        printWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Medikal TeÅŸhis Raporu</title>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
            <style>
              body { font-size: 12px; }
              .card { page-break-inside: avoid; }
              @media print {
                .btn { display: none; }
              }
            </style>
          </head>
          <body>
            <div class="container">
              ${reportContent}
            </div>
          </body>
          </html>
        `);

        printWindow.document.close();
        printWindow.print();
      }      document.getElementById("symptomForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        let checkedSymptoms = [];

        // Hangi yÃ¶ntem kullanÄ±lÄ±yorsa ona gÃ¶re semptomlarÄ± al
        if (currentMethod === 'checkbox') {
          checkedSymptoms = Array.from(
            document.querySelectorAll('input[name="symptoms"]:checked')
          ).map((cb) => cb.value);
        } else if (currentMethod === 'chatbot') {
          checkedSymptoms = extractedSymptoms;
        }

        if (checkedSymptoms.length === 0) {
          if (currentMethod === 'checkbox') {
            alert("LÃ¼tfen en az bir semptom seÃ§in!");
          } else {
            alert("LÃ¼tfen Ã¶nce chatbot ile semptomlarÄ±nÄ±zÄ± belirtin!");
          }
          return;
        }

        const selectedModel = document.getElementById("modelSelect").value;

        showLoading();

        try {
          const response = await fetch("/predict", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              symptoms: checkedSymptoms,
              model: selectedModel,
            }),
          });

          const result = await response.json();
          hideLoading();
          displayResult(result);
        } catch (error) {
          hideLoading();
          displayResult({ error: "BaÄŸlantÄ± hatasÄ±: " + error.message });
        }
      });

      // Chatbot deÄŸiÅŸkenleri
      let currentMethod = 'checkbox';
      let chatConversation = [];
      let extractedSymptoms = [];
      let isWaitingForResponse = false;

      // YÃ¶ntem seÃ§imi
      function selectMethod(method) {
        currentMethod = method;

        // Aktif method card'Ä±nÄ± gÃ¼ncelle
        document.querySelectorAll('.method-card').forEach(card => {
          card.classList.remove('active');
        });
        document.getElementById(method + 'Method').classList.add('active');

        // BÃ¶lÃ¼mleri gÃ¶ster/gizle
        if (method === 'checkbox') {
          document.getElementById('checkboxSection').style.display = 'block';
          document.getElementById('chatbotSection').style.display = 'none';
        } else {
          document.getElementById('checkboxSection').style.display = 'none';
          document.getElementById('chatbotSection').style.display = 'block';
        }
      }      // Sayfa yÃ¼klendiÄŸinde varsayÄ±lan olarak checkbox seÃ§
      document.addEventListener('DOMContentLoaded', function() {
        selectMethod('checkbox');
        renderSymptoms(allSymptoms);
        updateFilteredCount(allSymptoms.length);
        updateSelectedCount();
      });

      // Chat fonksiyonlarÄ±
      function handleChatKeyPress(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
          event.preventDefault();
          sendChatMessage();
        }
      }

      function sendChatMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();

        if (!message || isWaitingForResponse) return;

        // KullanÄ±cÄ± mesajÄ±nÄ± ekle
        addChatMessage(message, 'user');
        input.value = '';

        // Bot yanÄ±tÄ±nÄ± bekle
        isWaitingForResponse = true;
        showTypingIndicator();

        // MesajÄ± iÅŸle
        setTimeout(() => {
          processChatMessage(message);
          hideTypingIndicator();
          isWaitingForResponse = false;
        }, 1500);
      }

      function addChatMessage(message, sender) {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = sender === 'bot' ? 'bot-message' : 'user-message';

        const avatar = sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';

        messageDiv.innerHTML = `
          <div class="message-avatar">
            ${avatar}
          </div>
          <div class="message-content">
            <p>${message}</p>
          </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }      function processChatMessage(message) {
        // Backend'e mesaj gÃ¶nder
        fetch('/chat-process', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: message,
            conversation_history: chatConversation
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            addChatMessage('ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu: ' + data.error, 'bot');
          } else {
            handleBotResponse(data);
          }
        })
        .catch(error => {
          console.error('Chat error:', error);
          // Fallback: Local processing
          processLocalChatMessage(message);
        });
      }

      function handleBotResponse(response) {
        if (response.type === 'symptoms_detected') {
          // Tespit edilen semptomlarÄ± ekle
          if (response.symptoms) {
            response.symptoms.forEach(symptom => {
              if (!extractedSymptoms.includes(symptom)) {
                extractedSymptoms.push(symptom);
              }
            });
          }

          let message = response.message;
          if (response.suggestions && response.suggestions.length > 0) {
            message += '<br><br><small class="text-muted">Ã–neriler: ' + response.suggestions.join(', ') + '</small>';
          }

          addChatMessage(message, 'bot');

        } else if (response.type === 'diagnosis_request') {
          applySymptomsToCheckboxes();
          addChatMessage(response.message + '<br><br><strong>Åimdi aÅŸaÄŸÄ±daki "TeÅŸhis Et" butonuna tÄ±klayabilirsiniz.</strong>', 'bot');

        } else {
          addChatMessage(response.message, 'bot');
          if (response.suggestions) {
            setTimeout(() => {
              addSuggestionButtons(response.suggestions);
            }, 500);
          }
        }
      }

      function processLocalChatMessage(message) {
        // Fallback: Local semptom Ã§Ä±karma
        const symptoms = extractSymptomsFromText(message);

        if (symptoms.length > 0) {
          symptoms.forEach(symptom => {
            if (!extractedSymptoms.includes(symptom)) {
              extractedSymptoms.push(symptom);
            }
          });

          let response = `AnlÄ±yorum. Åu semptomlarÄ± tespit ettim: `;
          response += symptoms.map(s => `<span class="symptom-tag">${getTurkishSymptomName(s)}</span>`).join(' ');

          if (extractedSymptoms.length < 3) {
            response += `<br><br>BaÅŸka semptomlarÄ±nÄ±z var mÄ±? Daha detaylÄ± teÅŸhis iÃ§in en az 3-4 semptom belirtmeniz Ã¶nemli.`;
          } else {
            response += `<br><br>Toplam ${extractedSymptoms.length} semptom belirttiniz. TeÅŸhis iÃ§in "teÅŸhis et" yazabilir veya daha fazla semptom ekleyebilirsiniz.`;
          }

          addChatMessage(response, 'bot');
        } else if (message.toLowerCase().includes('teÅŸhis') || message.toLowerCase().includes('analiz')) {
          if (extractedSymptoms.length > 0) {
            applySymptomsToCheckboxes();
            addChatMessage('SemptomlarÄ±nÄ±zÄ± analiz ediyorum... LÃ¼tfen "TeÅŸhis Et" butonuna tÄ±klayÄ±n.', 'bot');
          } else {
            addChatMessage('TeÅŸhis yapabilmem iÃ§in Ã¶ncelikle semptomlarÄ±nÄ±zÄ± belirtmeniz gerekiyor.', 'bot');
          }
        } else {
          addChatMessage('SemptomlarÄ±nÄ±zÄ± daha detaylÄ± anlatabilir misiniz? Ã–rneÄŸin: "BaÅŸÄ±m aÄŸrÄ±yor", "AteÅŸim var", "Ã–ksÃ¼rÃ¼yorum" gibi.', 'bot');
        }
      }

      function addSuggestionButtons(suggestions) {
        const chatMessages = document.getElementById('chatMessages');
        const suggestionDiv = document.createElement('div');
        suggestionDiv.className = 'bot-message';

        let buttonsHtml = suggestions.map(suggestion =>
          `<button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="selectSuggestion('${suggestion}')">${suggestion}</button>`
        ).join('');

        suggestionDiv.innerHTML = `
          <div class="message-avatar">
            <i class="fas fa-robot"></i>
          </div>
          <div class="message-content">
            <p><small class="text-muted">HÄ±zlÄ± seÃ§enekler:</small></p>
            ${buttonsHtml}
          </div>
        `;

        chatMessages.appendChild(suggestionDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function selectSuggestion(suggestion) {
        document.getElementById('chatInput').value = suggestion;
        sendChatMessage();
      }      function extractSymptomsFromText(text) {
        const detectedSymptoms = [];
        const lowerText = text.toLowerCase();

        // KapsamlÄ± semptom-keyword eÅŸleÅŸtirme sÃ¶zlÃ¼ÄŸÃ¼ (tÃ¼m 132 semptom)
        const symptomKeywords = {
          'itching': ['kaÅŸÄ±n', 'kaÅŸÄ±', 'kaÅŸÄ±ntÄ±', 'kaÅŸÄ±k'],
          'skin_rash': ['cilt dÃ¶kÃ¼ntÃ¼', 'dÃ¶kÃ¼ntÃ¼', 'kÄ±zarÄ±k', 'cilt kÄ±zar', 'dÃ¶kÃ¼ntÃ¼lÃ¼'],
          'nodal_skin_eruptions': ['nodÃ¼l', 'cilt nodÃ¼l', 'ÅŸiÅŸlik cilt', 'cilt Ã§Ä±kÄ±ntÄ±'],
          'continuous_sneezing': ['sÃ¼rekli hapÅŸÄ±', 'hapÅŸÄ±r', 'hapÅŸÄ±rma', 'aksÄ±r'],
          'shivering': ['titre', 'titrek', 'sallan'],
          'chills': ['Ã¼ÅŸÃ¼', 'Ã¼ÅŸÃ¼me', 'soÄŸuk'],
          'joint_pain': ['eklem aÄŸrÄ±', 'kemik aÄŸrÄ±', 'eklem', 'romatizma', 'kemikler aÄŸrÄ±'],
          'stomach_pain': ['mide aÄŸrÄ±', 'karÄ±n aÄŸrÄ±', 'mide yanÄ±', 'mide acÄ±'],
          'acidity': ['ekÅŸi', 'mide ekÅŸi', 'yanma mide', 'asit'],
          'ulcers_on_tongue': ['dil yara', 'dil Ã¼lser', 'dil aft', 'dilde yara'],
          'muscle_wasting': ['kas eri', 'kas zayÄ±f', 'kas kayb'],
          'vomiting': ['kus', 'kusmak', 'kusma', 'mide boÅŸalt'],
          'burning_micturition': ['idrar yan', 'iÅŸer yanma', 'idrar yakar'],
          'spotting_ urination': ['kanla idrar', 'idrar kan', 'kanlÄ± idrar'],
          'fatigue': ['yorgun', 'bitkin', 'halsiz', 'gÃ¼Ã§sÃ¼z', 'enerjisiz'],
          'weight_gain': ['kilo al', 'ÅŸiÅŸmanla', 'kilo art'],
          'anxiety': ['anksiye', 'kaygÄ±', 'endiÅŸe', 'stres', 'gergin'],
          'cold_hands_and_feets': ['soÄŸuk el ayak', 'el ayak soÄŸuk', 'soÄŸuk uzuv'],
          'mood_swings': ['ruh hali deÄŸiÅŸ', 'duygusal', 'sinirli'],
          'weight_loss': ['kilo kay', 'zayÄ±fla', 'kilo dÃ¼ÅŸ'],
          'restlessness': ['huzursuz', 'rahat', 'sakin'],
          'lethargy': ['uyuÅŸuk', 'durgun', 'tembellik'],
          'patches_in_throat': ['boÄŸaz leke', 'boÄŸazda leke', 'boÄŸaz beyaz'],
          'irregular_sugar_level': ['ÅŸeker dÃ¼zensiz', 'kan ÅŸeker', 'ÅŸeker seviye'],
          'cough': ['Ã¶ksÃ¼rÃ¼k', 'Ã¶ksÃ¼r', 'Ã¶ksÃ¼ren', 'kuru Ã¶ksÃ¼rÃ¼k'],
          'high_fever': ['yÃ¼ksek ateÅŸ', 'ÅŸiddetli ateÅŸ', 'ateÅŸ yÃ¼ksek'],
          'sunken_eyes': ['Ã§Ã¶kÃ¼k gÃ¶z', 'gÃ¶z Ã§ukur', 'gÃ¶zler Ã§ukur'],
          'breathlessness': ['nefes dar', 'nefes alam', 'solun', 'nefes kesi'],
          'sweating': ['terle', 'aÅŸÄ±rÄ± ter', 'ter dÃ¶kmek'],
          'dehydration': ['susuz', 'kuru', 'sÄ±vÄ± kay'],
          'indigestion': ['hazÄ±msÄ±z', 'sindir', 'mide bozu'],
          'headache': ['baÅŸ aÄŸrÄ±', 'baÅŸÄ±m aÄŸrÄ±', 'migren', 'baÅŸ aÄŸÄ±r'],
          'yellowish_skin': ['sarÄ± cilt', 'sarÄ±msÄ±', 'sarÄ±lÄ±k'],
          'dark_urine': ['koyu idrar', 'idrar koyu', 'idrar renk'],
          'nausea': ['bulantÄ±', 'mide bulantÄ±', 'bulant'],
          'loss_of_appetite': ['iÅŸtah', 'yemek iste', 'aÃ§lÄ±k yok'],
          'pain_behind_the_eyes': ['gÃ¶z arkasÄ± aÄŸrÄ±', 'gÃ¶z arka', 'gÃ¶z Ã§evre aÄŸrÄ±'],
          'back_pain': ['sÄ±rt aÄŸrÄ±', 'bel aÄŸrÄ±', 'sÄ±rtÄ±m aÄŸrÄ±', 'omurga aÄŸrÄ±'],
          'constipation': ['kabÄ±z', 'tuvalete Ã§Ä±kam', 'dÄ±ÅŸkÄ± sert'],
          'abdominal_pain': ['karÄ±n aÄŸrÄ±', 'karnÄ±m aÄŸrÄ±', 'karÄ±n acÄ±'],
          'diarrhoea': ['ishal', 'karÄ±n boÅŸal', 'sulu dÄ±ÅŸkÄ±', 'amel'],
          'mild_fever': ['hafif ateÅŸ', 'dÃ¼ÅŸÃ¼k ateÅŸ', 'ateÅŸ az'],
          'yellow_urine': ['sarÄ± idrar', 'idrar sarÄ±'],
          'yellowing_of_eyes': ['gÃ¶z sarÄ±', 'gÃ¶zde sarÄ±lÄ±k', 'gÃ¶z sarÄ±la'],
          'acute_liver_failure': ['karaciÄŸer yetmez', 'karaciÄŸer kriz'],
          'fluid_overload': ['sÄ±vÄ± fazla', 'su toplan', 'Ã¶dem'],
          'swelling_of_stomach': ['mide ÅŸiÅŸ', 'karÄ±n ÅŸiÅŸ', 'mide bombe'],
          'swelled_lymph_nodes': ['lenf ÅŸiÅŸ', 'bezler ÅŸiÅŸ', 'boyun ÅŸiÅŸ'],
          'malaise': ['halsiz', 'hasta hiss', 'rahatsÄ±z'],
          'blurred_and_distorted_vision': ['bulanÄ±k gÃ¶rme', 'gÃ¶rme bozuk', 'gÃ¶z bulanÄ±k'],
          'phlegm': ['balgam', 'tÃ¼kÃ¼r', 'gÃ¶ÄŸÃ¼s balgam'],
          'throat_irritation': ['boÄŸaz tahriÅŸ', 'boÄŸaz yanma', 'boÄŸaz kaÅŸÄ±n'],
          'redness_of_eyes': ['gÃ¶z kÄ±zar', 'gÃ¶zde kÄ±zarÄ±k', 'gÃ¶z al'],
          'sinus_pressure': ['sinÃ¼s basÄ±n', 'burun basÄ±n', 'alÄ±n basÄ±n'],
          'runny_nose': ['burun ak', 'burun sÄ±zÄ±n', 'nezle'],
          'congestion': ['tÄ±kan', 'burun tÄ±kan', 'sinÃ¼s tÄ±kan'],
          'chest_pain': ['gÃ¶ÄŸÃ¼s aÄŸrÄ±', 'gÃ¶ÄŸsÃ¼m aÄŸrÄ±', 'kalp aÄŸrÄ±', 'gÃ¶ÄŸÃ¼s sÄ±kÄ±ÅŸ'],
          'weakness_in_limbs': ['uzuv gÃ¼Ã§sÃ¼z', 'kol bacak gÃ¼Ã§sÃ¼z', 'uzuvlarda gÃ¼Ã§sÃ¼z'],
          'fast_heart_rate': ['kalp hÄ±zlÄ±', 'nabÄ±z hÄ±zlÄ±', 'Ã§arpÄ±ntÄ±'],
          'pain_during_bowel_movements': ['tuvalet aÄŸrÄ±', 'dÄ±ÅŸkÄ± aÄŸrÄ±', 'bÃ¼yÃ¼k abdest aÄŸrÄ±'],
          'pain_in_anal_region': ['makattan aÄŸrÄ±', 'kuyruk aÄŸrÄ±', 'anÃ¼s aÄŸrÄ±'],
          'bloody_stool': ['kanlÄ± dÄ±ÅŸkÄ±', 'dÄ±ÅŸkÄ± kan', 'kakada kan'],
          'irritation_in_anus': ['makattan kaÅŸÄ±n', 'piÅŸik', 'anÃ¼s tahriÅŸ'],
          'neck_pain': ['boyun aÄŸrÄ±', 'boynum aÄŸrÄ±', 'ense aÄŸrÄ±'],
          'dizziness': ['baÅŸ dÃ¶n', 'sersem', 'dengem', 'vertigo'],
          'cramps': ['kramp', 'kas spazmÄ±', 'kasÄ±lma'],
          'bruising': ['mor', 'Ã§Ã¼rÃ¼k', 'berelenme'],
          'obesity': ['ÅŸiÅŸman', 'obez', 'kilolu'],
          'swollen_legs': ['bacak ÅŸiÅŸ', 'ayak ÅŸiÅŸ', 'bacaklarda ÅŸiÅŸ'],
          'swollen_blood_vessels': ['damar ÅŸiÅŸ', 'toplardamar ÅŸiÅŸ', 'varis'],
          'puffy_face_and_eyes': ['yÃ¼z ÅŸiÅŸ', 'gÃ¶z ÅŸiÅŸ', 'yÃ¼zde ÅŸiÅŸ'],
          'enlarged_thyroid': ['tiroid bÃ¼yÃ¼k', 'guatr', 'boyun ÅŸiÅŸ'],
          'brittle_nails': ['tÄ±rnak kÄ±rÄ±l', 'tÄ±rnak zayÄ±f', 'tÄ±rnaklar kÄ±rÄ±k'],
          'swollen_extremeties': ['uzuv ÅŸiÅŸ', 'el ayak ÅŸiÅŸ', 'ekstremite ÅŸiÅŸ'],
          'excessive_hunger': ['aÅŸÄ±rÄ± aÃ§lÄ±k', 'Ã§ok aÃ§', 'sÃ¼rekli aÃ§'],
          'extra_marital_contacts': ['evlilik dÄ±ÅŸÄ±', 'gÃ¼venli olmayan iliÅŸki'],
          'drying_and_tingling_lips': ['dudak kuru', 'dudak karÄ±nca', 'dudaklarda uyuÅŸma'],
          'slurred_speech': ['konuÅŸma bozuk', 'peltek', 'dilim dolaÅŸ'],
          'knee_pain': ['diz aÄŸrÄ±', 'dizim aÄŸrÄ±', 'diz acÄ±'],
          'hip_joint_pain': ['kalÃ§a aÄŸrÄ±', 'kalÃ§am aÄŸrÄ±', 'kalÃ§a eklem'],
          'muscle_weakness': ['kas gÃ¼Ã§sÃ¼z', 'kas zayÄ±f', 'kaslar gÃ¼Ã§sÃ¼z'],
          'stiff_neck': ['boyun sert', 'boyun katÄ±', 'ense sert'],
          'swelling_joints': ['eklem ÅŸiÅŸ', 'eklemlerde ÅŸiÅŸ', 'kemik ÅŸiÅŸ'],
          'movement_stiffness': ['hareket gÃ¼Ã§', 'katÄ±lÄ±k', 'sertlik'],
          'spinning_movements': ['sersemlik', 'baÅŸ dÃ¶nme', 'dÃ¶ner'],
          'loss_of_balance': ['denge kay', 'dengesiz', 'dÃ¼ÅŸ'],
          'unsteadiness': ['dengesiz', 'sallan', 'titrek'],
          'weakness_of_one_body_side': ['yarÄ±m vÃ¼cut gÃ¼Ã§sÃ¼z', 'tek taraf zayÄ±f', 'felÃ§'],
          'loss_of_smell': ['koku alamam', 'koku kay', 'koklama yok'],
          'bladder_discomfort': ['mesane rahatsÄ±z', 'idrar kesesi', 'mesane aÄŸrÄ±'],
          'foul_smell_of urine': ['idrar koku', 'idrar pis koku', 'kÃ¶tÃ¼ kokulu idrar'],
          'continuous_feel_of_urine': ['sÃ¼rekli idrar hiss', 'idrar hiss', 'tuvalete gidesi'],
          'passage_of_gases': ['gaz', 'osuruk', 'baÄŸÄ±rsak gaz'],
          'internal_itching': ['iÃ§ kaÅŸÄ±n', 'iÃ§ten kaÅŸÄ±n', 'iÃ§ taraf kaÅŸÄ±n'],
          'toxic_look_(typhos)': ['hasta gÃ¶rÃ¼n', 'zehirli gÃ¶rÃ¼n', 'solgun'],
          'depression': ['depres', 'Ã¼zÃ¼n', 'mutsuz', 'Ã§Ã¶kÃ¼k'],
          'irritability': ['sinirli', 'Ã§abuk sinirlen', 'asabi'],
          'muscle_pain': ['kas aÄŸrÄ±', 'kaslarÄ±m aÄŸrÄ±', 'kas acÄ±'],
          'altered_sensorium': ['kafa karÄ±ÅŸÄ±k', 'bilinÃ§ bulanÄ±k', 'farkÄ±nda deÄŸil'],
          'red_spots_over_body': ['vÃ¼cutta kÄ±rmÄ±zÄ± leke', 'kÄ±rmÄ±zÄ± nokta', 'dÃ¶kÃ¼ntÃ¼ kÄ±rmÄ±zÄ±'],
          'belly_pain': ['karÄ±n aÄŸrÄ±', 'gÃ¶bek aÄŸrÄ±', 'belly aÄŸrÄ±'],
          'abnormal_menstruation': ['adet dÃ¼zensiz', 'regl problemli', 'adet bozuk'],
          'dischromic _patches': ['cilt renk deÄŸiÅŸ', 'leke cilt', 'renk farkÄ±'],
          'watering_from_eyes': ['gÃ¶z sular', 'gÃ¶zyaÅŸÄ±', 'gÃ¶zden su gelme'],
          'increased_appetite': ['iÅŸtah art', 'Ã§ok yemek iste', 'aÅŸÄ±rÄ± iÅŸtah'],
          'polyuria': ['sÄ±k idrar', 'Ã§ok idrar Ã§Ä±kar', 'aÅŸÄ±rÄ± idrar'],
          'family_history': ['aile geÃ§miÅŸ', 'ailede hasta', 'kalÄ±tsal'],
          'mucoid_sputum': ['mukozlu balgam', 'sÃ¼mÃ¼klÃ¼ balgam', 'yapÄ±ÅŸkan balgam'],
          'rusty_sputum': ['paslÄ± balgam', 'kahverengi balgam', 'kanlÄ± balgam'],
          'lack_of_concentration': ['konsantrasyon yok', 'dikkatsiz', 'odaklan'],
          'visual_disturbances': ['gÃ¶rme bozuk', 'gÃ¶rme problemi', 'gÃ¶z problemi'],
          'receiving_blood_transfusion': ['kan nakli', 'kan almak', 'transfÃ¼zyon'],
          'receiving_unsterile_injections': ['steril olmayan iÄŸne', 'kirli enjektÃ¶r'],
          'coma': ['koma', 'bayÄ±lma', 'bilinÃ§ kay'],
          'stomach_bleeding': ['mide kana', 'mide kan', 'gastrik kanama'],
          'distention_of_abdomen': ['karÄ±n ÅŸiÅŸkin', 'karÄ±nda ÅŸiÅŸme', 'batÄ±n ÅŸiÅŸ'],
          'history_of_alcohol_consumption': ['alkol geÃ§miÅŸ', 'iÃ§ki kullan', 'alkol'],
          'fluid_overload.1': ['sÄ±vÄ± yÃ¼klen', 'su fazla', 'sÄ±vÄ± birikim'],
          'blood_in_sputum': ['balgam kan', 'kan tÃ¼kÃ¼r', 'balgamda kan'],
          'prominent_veins_on_calf': ['baldÄ±r damar', 'bacak damar belirgin', 'varis'],
          'palpitations': ['Ã§arpÄ±ntÄ±', 'kalp hÄ±zlÄ±', 'kalp Ã§arp'],
          'painful_walking': ['yÃ¼rÃ¼rken aÄŸrÄ±', 'yÃ¼rÃ¼me aÄŸrÄ±', 'adÄ±m aÄŸrÄ±'],
          'pus_filled_pimples': ['irinli sivilce', 'irin', 'sivilce irin'],
          'blackheads': ['siyah nokta', 'komedon', 'siyah ben'],
          'scurring': ['kabuk', 'yara kabuÄŸu', 'kuruma'],
          'skin_peeling': ['cilt soyul', 'deri soyul', 'kabuklan'],
          'silver_like_dusting': ['gÃ¼mÃ¼ÅŸ toz', 'pul pul', 'kepek'],
          'small_dents_in_nails': ['tÄ±rnak Ã§ukur', 'tÄ±rnakta nokta', 'tÄ±rnak delik'],
          'inflammatory_nails': ['tÄ±rnak iltihap', 'tÄ±rnak enfeksiyon', 'tÄ±rnak kÄ±zar'],
          'blister': ['su toplan', 'kabarcÄ±k', 'blister'],
          'red_sore_around_nose': ['burun Ã§evre yara', 'burun kÄ±zar', 'burun yara'],
          'yellow_crust_ooze': ['sarÄ± kabuk', 'sarÄ± akÄ±ntÄ±', 'irin akma'],
        };

        // Keyword eÅŸleÅŸtirme
        for (const [symptom, keywords] of Object.entries(symptomKeywords)) {
          for (const keyword of keywords) {
            if (lowerText.includes(keyword)) {
              if (!detectedSymptoms.includes(symptom)) {
                detectedSymptoms.push(symptom);
              }
              break;
            }
          }
        }

        return detectedSymptoms;
      }

      function applySymptomsToCheckboxes() {
        // Ã–nce tÃ¼m checkbox'larÄ± temizle
        const checkboxes = document.querySelectorAll('input[name="symptoms"]');
        checkboxes.forEach(cb => cb.checked = false);

        // Ã‡Ä±karÄ±lan semptomlarÄ± iÅŸaretle
        extractedSymptoms.forEach(symptom => {
          const checkbox = document.querySelector(`input[value="${symptom}"]`);
          if (checkbox) {
            checkbox.checked = true;
          }
        });

        updateSelectedCount();
      }

      function showTypingIndicator() {
        document.getElementById('typingIndicator').style.display = 'block';
      }

      function hideTypingIndicator() {
        document.getElementById('typingIndicator').style.display = 'none';
      }

      function clearChat() {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = `
          <div class="bot-message">
            <div class="message-avatar">
              <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
              <p>Merhaba! Ben Sanal Doktor AsistanÄ±nÄ±zÄ±m. ğŸ‘‹</p>
              <p>Hangi semptomlarÄ±nÄ±zÄ± yaÅŸÄ±yorsunuz? LÃ¼tfen detaylarÄ±yla anlatÄ±n.</p>
              <p><small class="text-muted">Ã–rnek: "BaÅŸÄ±m aÄŸrÄ±yor, ateÅŸim var ve Ã¶ksÃ¼rÃ¼yorum"</small></p>
            </div>
          </div>
        `;

        chatConversation = [];
        extractedSymptoms = [];
        document.getElementById('chatInput').value = '';
      }

      function getTurkishSymptomName(englishName) {
        // Semptom Ã§eviri fonksiyonu
        const translations = {
          'headache': 'BaÅŸ AÄŸrÄ±sÄ±',
          'fever': 'AteÅŸ',
          'cough': 'Ã–ksÃ¼rÃ¼k',
          'fatigue': 'Yorgunluk',
          'nausea': 'BulantÄ±',
          'vomiting': 'Kusma',
          'diarrhoea': 'Ä°shal',
          'stomach_pain': 'Mide AÄŸrÄ±sÄ±',
          'joint_pain': 'Eklem AÄŸrÄ±sÄ±',
          'muscle_pain': 'Kas AÄŸrÄ±sÄ±',
          'back_pain': 'SÄ±rt AÄŸrÄ±sÄ±',
          'chest_pain': 'GÃ¶ÄŸÃ¼s AÄŸrÄ±sÄ±',
          'breathlessness': 'Nefes DarlÄ±ÄŸÄ±',
          'dizziness': 'BaÅŸ DÃ¶nmesi',
          'skin_rash': 'Cilt DÃ¶kÃ¼ntÃ¼sÃ¼',
          'itching': 'KaÅŸÄ±ntÄ±',
          'sweating': 'Terleme',
          'weight_loss': 'Kilo KaybÄ±',
          'loss_of_appetite': 'Ä°ÅŸtahsÄ±zlÄ±k',
          'anxiety': 'Anksiyete',
          'depression': 'Depresyon',
          'abdominal_pain': 'KarÄ±n AÄŸrÄ±sÄ±',
          'constipation': 'KabÄ±zlÄ±k',
          'yellow_urine': 'SarÄ± Ä°drar',
          'dark_urine': 'Koyu Ä°drar',
          'high_fever': 'YÃ¼ksek AteÅŸ',
          'mild_fever': 'Hafif AteÅŸ',
          'chills': 'ÃœÅŸÃ¼me',
          'dehydration': 'Susuzluk'
        };

        return translations[englishName] || englishName;
      }

      // ...existing code...
    </script>
  </body>
</html>
